# MySQL 性能测试
## 文件系统与操作系统

```
磁盘调度算法设置为 deadline
[root@10.70.1.232 ~]#cat /sys/block/sda/queue/scheduler
noop anticipatory deadline [cfq]

```
## sysstat
```
[root@10.70.1.232 ~]#iostat
-bash: iostat: command not found
[root@10.70.1.232 ~]#
[root@10.70.1.232 ~]#
[root@10.70.1.232 ~]#
[root@10.70.1.232 ~]#yum install sysstat
Loaded plugins: fastestmirror, priorities
Setting up Install Process
Loading mirror speeds from cached hostfile
epel/metalink                                                                                                            | 7.8 kB     00:00
 * base: mirrors.tuna.tsinghua.edu.cn
 * epel: mirrors.ustc.edu.cn
 * extras: mirror.bit.edu.cn
 * updates: mirrors.tuna.tsinghua.edu.cn
base                                                                                                                     | 3.7 kB     00:00
epel                                                                                                                     | 4.7 kB     00:00
epel/primary_db                                                                                                                                             | 6.0 MB     00:08
extras                                                                                                                                                      | 3.4 kB     00:00
updates                                                                                                                                                     | 3.4 kB     00:00
xin                                                                                                                                                         | 2.9 kB     00:00
168 packages excluded due to repository priority protections
Resolving Dependencies
--> Running transaction check
---> Package sysstat.x86_64 0:9.0.4-33.el6 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

===================================================================================================================================================================================
 Package                                   Arch                                     Version                                           Repository                              Size
===================================================================================================================================================================================
Installing:
 sysstat                                   x86_64                                   9.0.4-33.el6                                      base                                   234 k

Transaction Summary
===================================================================================================================================================================================
Install       1 Package(s)

Total download size: 234 k
Installed size: 826 k
Is this ok [y/N]: y
Downloading Packages:
sysstat-9.0.4-33.el6.x86_64.rpm                                                                                                                             | 234 kB     00:00
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : sysstat-9.0.4-33.el6.x86_64                                                                                                                                     1/1
  Verifying  : sysstat-9.0.4-33.el6.x86_64                                                                                                                                     1/1

Installed:
  sysstat.x86_64 0:9.0.4-33.el6

Complete!
[root@10.70.1.232 ~]#iostat -xm 1
Linux 2.6.32-573.el6.x86_64 (moban) 	01/15/2018 	_x86_64_	(4 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.27    0.00    0.08    1.31    0.00   98.34

Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.01     2.92    0.06    1.09     0.00     0.02    42.64     0.27  232.88   31.03  244.25  53.86   6.17

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.00    0.00    0.00  100.00

Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.25   11.72    0.00   88.03

Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.00   110.00    0.00    0.00     0.00     0.00     0.00    70.77    0.00    0.00    0.00   0.00  46.90

^C
[root@10.70.1.232 ~]#

```
## sar
```
sar [options] [-A] [-o file] t [n]

其中：

t为采样间隔，n为采样次数，默认值是1；

-o file表示将命令结果以二进制格式存放在文件中，file 是文件名。

options 为命令行选项，sar命令常用选项如下：

-A：所有报告的总和

-u：输出CPU使用情况的统计信息

-v：输出inode、文件和其他内核表的统计信息

-d：输出每一个块设备的活动信息

-r：输出内存和交换空间的统计信息

-b：显示I/O和传送速率的统计信息

-a：文件读写情况

-c：输出进程统计信息，每秒创建的进程数

-R：输出内存页面的统计信息

-y：终端设备活动情况

-w：输出系统交换活动信息

```
### CPU资源监控
```
[root@10.70.1.232 ~]#sar -u -f test
Linux 2.6.32-573.el6.x86_64 (moban) 	01/15/2018 	_x86_64_	(4 CPU)

11:12:21 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
11:12:31 PM     all      0.03      0.00      0.03      0.30      0.00     99.65
11:12:41 PM     all      0.03      0.00      0.05      0.53      0.00     99.40
11:12:51 PM     all      0.03      0.00      0.07      0.55      0.00     99.35
Average:        all      0.03      0.00      0.05      0.46      0.00     99.47

CPU：all 表示统计信息为所有 CPU 的平均值。

%user：显示在用户级别(application)运行使用 CPU 总时间的百分比。

%nice：显示在用户级别，用于nice操作，所占用 CPU 总时间的百分比。

%system：在核心级别(kernel)运行所使用 CPU 总时间的百分比。

%iowait：显示用于等待I/O操作占用 CPU 总时间的百分比。

%steal：管理程序(hypervisor)为另一个虚拟进程提供服务而等待虚拟 CPU 的百分比。

%idle：显示 CPU 空闲时间占用 CPU 总时间的百分比。

1. 若 %iowait 的值过高，表示硬盘存在I/O瓶颈

2. 若 %idle 的值高但系统响应慢时，有可能是 CPU 等待分配内存，此时应加大内存容量

3. 若 %idle 的值持续低于1，则系统的 CPU 处理能力相对较低，表明系统中最需要解决的资源是 CPU 。

如果要查看二进制文件test中的内容，需键入如下sar命令：

sar -u -f test

```

## iostat
```
[root@10.70.1.232 ~]#iostat -xm 1 sda
Linux 2.6.32-573.el6.x86_64 (moban) 	01/15/2018 	_x86_64_	(4 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.27    0.00    0.08    1.31    0.00   98.34

Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.01     2.91    0.06    1.09     0.00     0.02    42.58     0.27  233.45   31.02  244.82  53.80   6.17

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.00    0.00    0.00  100.00

Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.00    0.00    0.00  100.00
           
           

rrqm/s 每秒发起合并读的次数 read request merge
wrqm/s 每秒发起合并写的次数 write request merge

r/s 每秒读的次数
w/s 每秒写的次数

r/s + w /s = iops

rMB/s 
wMB/s 

avgrq-sz 平均请求扇区的大小 每秒请求读取的扇区的数量 每个扇区的大小是512字节  
avgqu-sz 平均队列长度 是平均请求队列的长度。毫无疑问，队列长度越短越好
          
await  等待时间
每一个IO请求的处理的平均时间（单位是微秒毫秒）。这里可以理解为IO的响应时间，一般地系统IO响应时间应该低于5ms，如果大于10ms就比较大了。
         这个时间包括了队列时间和服务时间，也就是说，一般情况下，await大于svctm，它们的差值越小，则说明队列时间越短，反之差值越大，队列时间越长，说明系统出了问题。
         
svctm  服务时间
表示平均每次设备I/O操作的服务时间（以毫秒为单位）。如果svctm的值与await很接近，表示几乎没有I/O等待，磁盘性能很好，如果await的值远高于svctm的值，则表示I/O队列等待太长，         系统上运行的应用程序将变慢。

%util 磁盘使用率
在统计时间内所有处理IO时间，除以总共统计时间。例如，如果统计间隔1秒，该设备有0.8秒在处理IO，而0.2秒闲置，那么该设备的%util = 0.8/1 = 80%，所以该参数暗示了设备的繁忙程度
。一般地，如果该参数是100%表示设备已经接近满负荷运行了（当然如果是多磁盘，即使%util是100%，因为磁盘的并发能力，所以磁盘使用未必就到了瓶颈）。

```

## sysbench

https://github.com/akopytov/sysbench

### 1. install in mac
```
mac:
brew install sysbench
```
### 2. install in centos
```
[root@10.70.1.232 ~]#yum install sysbench
Loaded plugins: fastestmirror, priorities
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: mirrors.tuna.tsinghua.edu.cn
 * epel: mirrors.ustc.edu.cn
 * extras: mirror.bit.edu.cn
 * updates: mirrors.tuna.tsinghua.edu.cn
168 packages excluded due to repository priority protections
Resolving Dependencies
--> Running transaction check
---> Package sysbench.x86_64 0:1.0.9-2.el6 will be installed
--> Processing Dependency: libmysqlclient_r.so.16(libmysqlclient_16)(64bit) for package: sysbench-1.0.9-2.el6.x86_64
--> Processing Dependency: libck.so.0()(64bit) for package: sysbench-1.0.9-2.el6.x86_64
--> Processing Dependency: libluajit-5.1.so.2()(64bit) for package: sysbench-1.0.9-2.el6.x86_64
--> Processing Dependency: libmysqlclient_r.so.16()(64bit) for package: sysbench-1.0.9-2.el6.x86_64
--> Running transaction check
---> Package ck.x86_64 0:0.5.2-2.el6 will be installed
---> Package luajit.x86_64 0:2.0.4-3.el6 will be installed
---> Package mysql-libs.x86_64 0:5.1.73-8.el6_8 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

===================================================================================================================================================================================
 Package                                     Arch                                    Version                                           Repository                             Size
===================================================================================================================================================================================
Installing:
 sysbench                                    x86_64                                  1.0.9-2.el6                                       epel                                  138 k
Installing for dependencies:
 ck                                          x86_64                                  0.5.2-2.el6                                       epel                                   24 k
 luajit                                      x86_64                                  2.0.4-3.el6                                       epel                                  302 k
 mysql-libs                                  x86_64                                  5.1.73-8.el6_8                                    base                                  1.2 M

Transaction Summary
===================================================================================================================================================================================
Install       4 Package(s)

Total download size: 1.7 M
Installed size: 5.6 M
Is this ok [y/N]: y
Downloading Packages:
(1/4): ck-0.5.2-2.el6.x86_64.rpm                                                                                                                            |  24 kB     00:00
(2/4): luajit-2.0.4-3.el6.x86_64.rpm                                                                                                                        | 302 kB     00:00
(3/4): mysql-libs-5.1.73-8.el6_8.x86_64.rpm                                                                                                                 | 1.2 MB     00:09
(4/4): sysbench-1.0.9-2.el6.x86_64.rpm                                                                                                                      | 138 kB     00:00
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                              162 kB/s | 1.7 MB     00:10
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : mysql-libs-5.1.73-8.el6_8.x86_64                                                                                                                                1/4
warning: /etc/my.cnf created as /etc/my.cnf.rpmnew
  Installing : ck-0.5.2-2.el6.x86_64                                                                                                                                           2/4
  Installing : luajit-2.0.4-3.el6.x86_64                                                                                                                                       3/4
  Installing : sysbench-1.0.9-2.el6.x86_64                                                                                                                                     4/4
  Verifying  : sysbench-1.0.9-2.el6.x86_64                                                                                                                                     1/4
  Verifying  : luajit-2.0.4-3.el6.x86_64                                                                                                                                       2/4
  Verifying  : ck-0.5.2-2.el6.x86_64                                                                                                                                           3/4
  Verifying  : mysql-libs-5.1.73-8.el6_8.x86_64                                                                                                                                4/4

Installed:
  sysbench.x86_64 0:1.0.9-2.el6

Dependency Installed:
  ck.x86_64 0:0.5.2-2.el6                               luajit.x86_64 0:2.0.4-3.el6                               mysql-libs.x86_64 0:5.1.73-8.el6_8

Complete!
[root@10.70.1.232 ~]#sysbench
sysbench 1.0.9 (using system LuaJIT 2.0.4)

```



### fileio
```
 mysqldata git:(master) ✗ sysbench --test=fileio help
WARNING: the --test option is deprecated. You can pass a script name or path on the command line without any options.
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

fileio options:
  --file-num=N              number of files to create [128]  -------生成测试文件的数量
  --file-block-size=N       block size to use in all IO operations [16384] ------测试期间文件块的大小。InnoDB存储引擎，每个页面的大小为16k 也就是16*1024=16384。
  --file-total-size=SIZE    total size of files to create [2G] ----每个文件的大小
  --file-test-mode=STRING   test mode {seqwr, seqrewr, seqrd, rndrd, rndwr, rndrw}-------文件测试模式，seqwr-顺序写 seqrewr-顺序读写 seqrd-顺序读 rndrd-随机读 rndwr-随机写 rndrw-随机读写
  --file-io-mode=STRING     file operations mode {sync,async,mmap} [sync]---文件操作的模式，同步、异步、MMAP（map映射）
  --file-extra-flags=STRING additional flags to use on opening files {sync,dsync,direct} []------打开文件时的选项，与API相关的参数
  --file-fsync-freq=N       do fsync() after this number of requests (0 - don't use fsync()) [100]--------执行fsync函数的频率。fsync主要是同步磁盘文件，因为可能有系统和磁盘缓冲的关系。
  --file-fsync-all[=on|off] do fsync() after each write operation [off]-----没执行完一次写操作，就执行一次fsync。默认关闭
  --file-fsync-end[=on|off] do fsync() at the end of test [on]----在测试结束时，执行fsync。默认 on
  --file-fsync-mode=STRING  which method to use for synchronization {fsync, fdatasync} [fsync]----文件同步函数的选择，多个操作系统对fdatasync支持的不同，不建议使用fdatasync。默认为fsync。
  --file-merged-requests=N  merge at most this number of IO requests if possible (0 - don't merge) [0]-------尽可能的合并N个IO请求数，0表示不合并，默认值：0。
  --file-rw-ratio=N         reads/writes ratio for combined test [1.5]-----测试时的读写比例 默认是2：1

➜  mysqldata git:(master) ✗

```

#### 案例
```
## 1. prepare 准备阶段，生产需要的测试文件
sysbench --test=fileio --file-num=4 --file-block-size=16384 --file-total-size=1G --file-test-mode=seqrd prepare
WARNING: the --test option is deprecated. You can pass a script name or path on the command line without any options.
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

4 files, 262144Kb each, 1024Mb total
Creating files for the test...
Extra file open flags: 0
Creating file test_file.0
Creating file test_file.1
Creating file test_file.2
Creating file test_file.3
1073741824 bytes written in 16.42 seconds (62.34 MiB/sec).

//  --file-num=4 生成4个文件
// --file-block-size=16384 块大小16k 
// --file-total-size=1G 总大小1G 所以每个文件是256M
➜  mysqldata git:(master) ✗ ll test*
-rw-------  1 ShaoGaoJie  staff  268435456  1 13 11:13 test_file.0  
-rw-------  1 ShaoGaoJie  staff  268435456  1 13 11:13 test_file.1
-rw-------  1 ShaoGaoJie  staff  268435456  1 13 11:13 test_file.2
-rw-------  1 ShaoGaoJie  staff  268435456  1 13 11:13 test_file.3


## 2. run 实际测试阶段

➜  mysqldata git:(master) ✗ sysbench --test=fileio --file-num=4 --file-block-size=16384 --file-total-size=1G --file-test-mode=rndrw run
WARNING: the --test option is deprecated. You can pass a script name or path on the command line without any options.
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Extra file open flags: 0
4 files, 256MiB each
1GiB total file size
Block size 16KiB
Number of IO requests: 0
Read/Write ratio for combined random IO test: 1.50
Periodic FSYNC enabled, calling fsync() each 100 requests.
Calling fsync() at the end of test, Enabled.
Using synchronous I/O mode
Doing random r/w test
Initializing worker threads...

Threads started!


File operations:
    reads/s:                      1379.51
    writes/s:                     919.68
    fsyncs/s:                     91.87

Throughput:
    read, MiB/s:                  21.55
    written, MiB/s:               14.37

General statistics:
    total time:                          10.0009s
    total number of events:              23919

Latency (ms):
         min:                                  0.01
         avg:                                  0.41
         max:                                 82.61
         95th percentile:                      1.61
         sum:                               9823.76

Threads fairness:
    events (avg/stddev):           23919.0000/0.00
    execution time (avg/stddev):   9.8238/0.00

➜  mysqldata git:(master) ✗



## 3. cleanup 清理测试产生的文件

sysbench --test=fileio --file-num=4 --file-block-size=16384 --file-total-size=1G --file-test-mode=rndrw cleanup
WARNING: the --test option is deprecated. You can pass a script name or path on the command line without any options.
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

Removing test files...
➜  mysqldata git:(master) ✗


```


### oltp测试
```
## 1. prepare阶段会根据选项产生指定行数的表。
sysbench --db-driver=mysql --mysql-user=root --mysql-password='' --mysql-socket=/tmp/mysql.sock --mysql-db=test --range_size=100 --table_size=10000 --tables=2 --threads=1 --events=0 --time=60 --rand-type=uniform /usr/local/Cellar/sysbench/1.0.11_1/share/sysbench/oltp_read_only.lua prepare
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

Creating table 'sbtest1'...
Inserting 10000 records into 'sbtest1'
Creating a secondary index on 'sbtest1'...
Creating table 'sbtest2'...
Inserting 10000 records into 'sbtest2'
Creating a secondary index on 'sbtest2'...



(root@localhost)[test]> show tables like 'sb%';
+----------------------+
| Tables_in_test (sb%) |
+----------------------+
| sbtest1              |
| sbtest2              |
+----------------------+
2 rows in set (0.01 sec)


## 执行

➜  sysbench sysbench --db-driver=mysql --mysql-user=root --mysql-password='' --mysql-socket=/tmp/mysql.sock --mysql-db=test --range_size=100 --table_size=10000 --tables=2 --threads=1 --events=0 --time=60 --rand-type=uniform /usr/local/Cellar/sysbench/1.0.11_1/share/sysbench/oltp_read_only.lua run
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            159082
        write:                           0
        other:                           22726
        total:                           181808
    transactions:                        11363  (189.35 per sec.)
    queries:                             181808 (3029.61 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          60.0080s
    total number of events:              11363

Latency (ms):
         min:                                  3.65
         avg:                                  5.28
         max:                                240.93
         95th percentile:                      7.17
         sum:                              59962.27

Threads fairness:
    events (avg/stddev):           11363.0000/0.00
    execution time (avg/stddev):   59.9623/0.00
    
    
    

## 3. cleanup  
➜  sysbench sysbench --db-driver=mysql --mysql-user=root --mysql-password='' --mysql-socket=/tmp/mysql.sock --mysql-db=test --range_size=100 --table_size=10000 --tables=2 --threads=1 --events=0 --time=60 --rand-type=uniform /usr/local/Cellar/sysbench/1.0.11_1/share/sysbench/oltp_read_only.lua cleanup
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

Dropping table 'sbtest1'...
Dropping table 'sbtest2'...
    
    
```

## 文件系统

```
伪代码

f = fopen('xx.xx',wb);
// fwrite(f,offset ,data, len); 数据写入了page cache 操作系统缓存。
fwrite(f,16k X 0,'xxxxxxxxxxxx',16384);
fwrite(f,16k X 1,'xxxxxxxxxxxx',16384);
fwrite(f,16k X 2,'xxxxxxxxxxxx',16384);
fwrite(f,16k X 3,'xxxxxxxxxxxx',16384);

//刷新到磁盘  --file-fsync-freq 刷磁盘的频率。就算设置为0 操作系统也会按照自己的算法进行刷盘。
fsync(f);


O_DIRECT 直接写磁盘 不写page cache

--file-extra-flags=DIRECT //sysbench测试的时候可以设置这个。
f = fopen('xx.xx',wb, O_DIRECT);


```

### innodb\_flush_method

```
(root@localhost)[(none)]> show variables like 'innodb%flush%method';
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| innodb_flush_method |       |
+---------------------+-------+
1 row in set (0.02 sec)

重启

//直接写盘 不写操作系统的缓存。其实本身已经有了buffer pool。没必要写page cache。
(root@localhost)[(none)]> show variables like 'innodb_flush_method';
+---------------------+----------+
| Variable_name       | Value    |
+---------------------+----------+
| innodb_flush_method | O_DIRECT |
+---------------------+----------+
1 row in set (0.09 sec)

```

#### 哪些写入是O_DIRECT 哪些是写入page cache？
对于数据文件，用O_DIRECT 直接写磁盘 确保每次数据都写入了磁盘。
对于日志文件，通过先写入page cache 然后调用fsync刷入磁盘。

### innodb\_io_capacity

```
(root@localhost)[(none)]> show variables like 'innodb%io%';
+------------------------------------------+--------+
| Variable_name                            | Value  |
+------------------------------------------+--------+
| innodb_compression_failure_threshold_pct | 5      |
| innodb_compression_level                 | 6      |
| innodb_compression_pad_pct_max           | 50     |
| innodb_io_capacity                       | 200    |---用来表示磁盘IO的吞吐量,默认值是200
| innodb_io_capacity_max                   | 2000   |
| innodb_read_io_threads                   | 4      |
| innodb_replication_delay                 | 0      |
| innodb_use_native_aio                    | OFF    |
| innodb_version                           | 5.7.20 |
| innodb_write_io_threads                  | 4      |
+------------------------------------------+--------+
10 rows in set (0.01 sec)

```

## QPS & TPS
#### QPS query per second
#### TPS transaction per second
```
(root@localhost)[(none)]> show global status like '%uptime%';
+---------------------------+-------+
| Variable_name             | Value |
+---------------------------+-------+
| Uptime                    | 653   |----运行到现在的秒数
| Uptime_since_flush_status | 653   |
+---------------------------+-------+
2 rows in set (0.00 sec)

(root@localhost)[(none)]>
(root@localhost)[(none)]>
(root@localhost)[(none)]> show global status like '%question%'
    -> ;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Questions     | 11    |---------总的查询量
+---------------+-------+
1 row in set (0.00 sec)


(root@localhost)[(none)]> status
--------------
mysql  Ver 14.14 Distrib 5.7.20, for osx10.13 (x86_64) using  EditLine wrapper

Connection id:		3
Current database:
Current user:		root@localhost
SSL:			Not in use
Current pager:		less
Using outfile:		''
Using delimiter:	;
Server version:		5.7.20-log Homebrew
Protocol version:	10
Connection:		Localhost via UNIX socket
Server characterset:	utf8mb4
Db     characterset:	utf8mb4
Client characterset:	utf8
Conn.  characterset:	utf8
UNIX socket:		/tmp/mysql.sock
Uptime:			13 min 7 sec

Threads: 1  Questions: 24  Slow queries: 0  Opens: 110  Flush tables: 1  Open tables: 103  Queries per second avg: 0.030
--------------

(root@localhost)[(none)]>

```


### mysqladmin
```

➜  ~ git:(master) ✗ mysqladmin extended-status -uroot  -r -i 1 | grep -i -E "Questions|Com_select|Com_update|Com_insert|Com_delete"

➜  mysqladmin extended-status -S /tmp/mysql.sock -uroot -P3307 -p -i 1 -r

+-----------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Variable_name                                 | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+-----------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Aborted_clients                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Aborted_connects                              | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Binlog_cache_disk_use                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Binlog_cache_use                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Binlog_stmt_cache_disk_use                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Binlog_stmt_cache_use                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Bytes_received                                | 1884                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Bytes_sent                                    | 25190                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Com_admin_commands                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_assign_to_keycache                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_db                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_db_upgrade                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_event                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_function                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_instance                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_procedure                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_server                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_table                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_tablespace                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_alter_user                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_analyze                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_begin                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_binlog                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_call_procedure                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_change_db                                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_change_master                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_change_repl_filter                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_check                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_checksum                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_commit                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_db                                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_event                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_function                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_index                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_procedure                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_server                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_table                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_trigger                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_udf                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_user                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_create_view                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_dealloc_sql                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_delete                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_delete_multi                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_do                                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_db                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_event                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_function                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_index                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_procedure                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_server                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_table                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_trigger                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_user                                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_drop_view                                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_empty_query                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_execute_sql                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_explain_other                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_flush                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_get_diagnostics                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_grant                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_ha_close                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_ha_open                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_ha_read                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_help                                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_insert                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_insert_select                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_install_plugin                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_kill                                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_load                                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_lock_tables                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_optimize                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_preload_keys                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_prepare_sql                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_purge                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_purge_before_date                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_release_savepoint                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_rename_table                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_rename_user                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_repair                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_replace                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_replace_select                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_reset                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_resignal                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_revoke                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_revoke_all                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_rollback                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_rollback_to_savepoint                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_savepoint                                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_select                                    | 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_set_option                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_signal                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_binlog_events                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_binlogs                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_charsets                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_collations                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_create_db                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_create_event                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_create_func                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_create_proc                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_create_table                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_create_trigger                       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_databases                            | 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_engine_logs                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_engine_mutex                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_engine_status                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_events                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_errors                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_fields                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_function_code                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_function_status                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_grants                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_keys                                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_master_status                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_open_tables                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_plugins                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_privileges                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_procedure_code                       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_procedure_status                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_processlist                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_profile                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_profiles                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_relaylog_events                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_slave_hosts                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_slave_status                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_status                               | 17                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Com_show_storage_engines                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_table_status                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_tables                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_triggers                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_variables                            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_warnings                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_show_create_user                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_shutdown                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_slave_start                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_slave_stop                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_group_replication_start                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_group_replication_stop                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_stmt_execute                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_stmt_close                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_stmt_fetch                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_stmt_prepare                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_stmt_reset                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_stmt_send_long_data                       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_truncate                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_uninstall_plugin                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_unlock_tables                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_update                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_update_multi                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_xa_commit                                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_xa_end                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_xa_prepare                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_xa_recover                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_xa_rollback                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_xa_start                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Com_stmt_reprepare                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connection_errors_accept                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connection_errors_internal                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connection_errors_max_connections             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connection_errors_peer_address                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connection_errors_select                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connection_errors_tcpwrap                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Connections                                   | 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Created_tmp_disk_tables                       | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Created_tmp_files                             | 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Created_tmp_tables                            | 81                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Delayed_errors                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Delayed_insert_threads                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Delayed_writes                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Flush_commands                                | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_commit                                | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Handler_delete                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_discover                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_external_lock                         | 259                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Handler_mrr_init                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_prepare                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_read_first                            | 13                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Handler_read_key                              | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Handler_read_last                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_read_next                             | 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_read_prev                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_read_rnd                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_read_rnd_next                         | 12030                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Handler_rollback                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_savepoint                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_savepoint_rollback                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_update                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Handler_write                                 | 6142                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Innodb_buffer_pool_dump_status                | Dumping of buffer pool not started                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Innodb_buffer_pool_load_status                | Buffer pool(s) load completed at 180116  6:50:45                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Innodb_buffer_pool_resize_status              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Innodb_buffer_pool_pages_data                 | 404                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Innodb_buffer_pool_bytes_data                 | 6619136                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Innodb_buffer_pool_pages_dirty                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_buffer_pool_bytes_dirty                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_buffer_pool_pages_flushed              | 39                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Innodb_buffer_pool_pages_free                 | 7787                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Innodb_buffer_pool_pages_misc                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_buffer_pool_pages_total                | 8191                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Innodb_buffer_pool_read_ahead_rnd             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_buffer_pool_read_ahead                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_buffer_pool_read_ahead_evicted         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_buffer_pool_read_requests              | 1965                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Innodb_buffer_pool_reads                      | 370                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Innodb_buffer_pool_wait_free                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_buffer_pool_write_requests             | 515                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Innodb_data_fsyncs                            | 7                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_data_pending_fsyncs                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_data_pending_reads                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_data_pending_writes                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_data_read                              | 6132224                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Innodb_data_reads                             | 398                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Innodb_data_writes                            | 56                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Innodb_data_written                           | 673792                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Innodb_dblwr_pages_written                    | 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_dblwr_writes                           | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_log_waits                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_log_write_requests                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_log_writes                             | 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_os_log_fsyncs                          | 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_os_log_pending_fsyncs                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_os_log_pending_writes                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_os_log_written                         | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Innodb_page_size                              | 16384                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Innodb_pages_created                          | 35                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Innodb_pages_read                             | 369                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Innodb_pages_written                          | 39                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Innodb_row_lock_current_waits                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_row_lock_time                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_row_lock_time_avg                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_row_lock_time_max                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_row_lock_waits                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_rows_deleted                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_rows_inserted                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_rows_read                              | 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_rows_updated                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_num_open_files                         | 20                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Innodb_truncated_status_writes                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Innodb_available_undo_logs                    | 128                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Key_blocks_not_flushed                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Key_blocks_unused                             | 6695                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Key_blocks_used                               | 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Key_read_requests                             | 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Key_reads                                     | 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Key_write_requests                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Key_writes                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Locked_connects                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Max_execution_time_exceeded                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Max_execution_time_set                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Max_execution_time_set_failed                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Max_used_connections                          | 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Max_used_connections_time                     | 2018-01-16 07:06:16                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Not_flushed_delayed_rows                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ongoing_anonymous_transaction_count           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Open_files                                    | 16                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Open_streams                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Open_table_definitions                        | 245                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Open_tables                                   | 106                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Opened_files                                  | 386                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Opened_table_definitions                      | 245                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Opened_tables                                 | 113                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Performance_schema_accounts_lost              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_cond_classes_lost          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_cond_instances_lost        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_digest_lost                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_file_classes_lost          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_file_handles_lost          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_file_instances_lost        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_hosts_lost                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_index_stat_lost            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_locker_lost                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_memory_classes_lost        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_metadata_lock_lost         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_mutex_classes_lost         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_mutex_instances_lost       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_nested_statement_lost      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_prepared_statements_lost   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_program_lost               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_rwlock_classes_lost        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_rwlock_instances_lost      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_session_connect_attrs_lost | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_socket_classes_lost        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_socket_instances_lost      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_stage_classes_lost         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_statement_classes_lost     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_table_handles_lost         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_table_instances_lost       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_table_lock_stat_lost       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_thread_classes_lost        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_thread_instances_lost      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Performance_schema_users_lost                 | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Prepared_stmt_count                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Qcache_free_blocks                            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Qcache_free_memory                            | 1031832                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Qcache_hits                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Qcache_inserts                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Qcache_lowmem_prunes                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Qcache_not_cached                             | 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Qcache_queries_in_cache                       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Qcache_total_blocks                           | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Queries                                       | 31                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Questions                                     | 28                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Rsa_public_key                                | -----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtBRHtnH2f6x1jUu6EsmQ
h6pOkeqVd9fyKjROtX+FrieuXlJprPyAj5ELpQemuzO5YJnvJL5+H6A0TS90gmCY
0I7PERpxc6e9U2wwp86l+ZQv5dUgzYGLRIpkFUBM8lYKTsZn373J9kfSXg2jsrJ9
ZXke1cfKU6DCFtKaXHL11ZbKFpaRpLVeAKlbq04FHewZBZp7WovrBVD5FEzuBQMp
sS9+1a1dvC31dzRxremSjwrzhST4KWTGPn47rU23o926Gvzfu+F1aNFNChzCn4nC
1nu5OUOMgQkTXh5IFv7rvbasus//rTD2iHgthdSCSlRJJu+nl6uVo+/xr00k3dRT
cQIDAQAB
-----END PUBLIC KEY-----
 |
| Select_full_join                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Select_full_range_join                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Select_range                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Select_range_check                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Select_scan                                   | 37                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Slave_open_temp_tables                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Slow_launch_threads                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Slow_queries                                  | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Sort_merge_passes                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Sort_range                                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Sort_rows                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Sort_scan                                     | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_accept_renegotiates                       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_accepts                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_callback_cache_hits                       | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_cipher                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Ssl_cipher_list                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Ssl_client_connects                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_connect_renegotiates                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_ctx_verify_depth                          | 18446744073709551615                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Ssl_ctx_verify_mode                           | 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_default_timeout                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_finished_accepts                          | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_finished_connects                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_server_not_after                          | Dec 29 01:26:17 2027 GMT                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Ssl_server_not_before                         | Dec 31 01:26:17 2017 GMT                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Ssl_session_cache_hits                        | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_session_cache_misses                      | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_session_cache_mode                        | SERVER                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Ssl_session_cache_overflows                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_session_cache_size                        | 128                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Ssl_session_cache_timeouts                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_sessions_reused                           | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_used_session_cache_entries                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_verify_depth                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_verify_mode                               | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Ssl_version                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Table_locks_immediate                         | 115                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Table_locks_waited                            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Table_open_cache_hits                         | 17                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Table_open_cache_misses                       | 113                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Table_open_cache_overflows                    | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Tc_log_max_pages_used                         | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Tc_log_page_size                              | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Tc_log_page_waits                             | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Threads_cached                                | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Threads_connected                             | 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Threads_created                               | 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Threads_running                               | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Uptime                                        | 1063                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Uptime_since_flush_status                     | 1063                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+-----------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

+-----------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Variable_name                                 | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+-----------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


```

## 基准测试工具
### sysbench
1. 简单高效的基准测试工具
2. 可以根据某个具体操作进行测试
3. 支持Oracle、PostgreSQL的测试
4. 脚本列表

|参数|说明|默认值|
|:--|:--|:--|
|--oltp-table-name|测试表的表名|sbtest|
|--oltp-tables-count|测试的表的数量|1|
|--oltp-table-size|每张测试表的记录数量|10000|
|--oltp-table-type|热点数据的分布 可选：uniform（离散） gaussian（高斯分布） special（启用下边的两个参数）|special|
|--oltp-dist-pct|百分之多少的数据视为热点数据|1|
|--oltp-dist-res|热点数据的访问频率|75|
|--mysql-host/password/prot/user|连接mysql的各项参数||
|--mysql-db|默认的测试数据库名字|sbtest|

```
➜  ~ git:(master) ✗ cd /usr/local/Cellar/sysbench/1.0.11_1/share/sysbench/
➜  sysbench ll
total 120
-rwxr-xr-x  1 ShaoGaoJie  admin   1452 12 10 01:05 bulk_insert.lua
-rw-r--r--  1 ShaoGaoJie  admin  13816 12 10 01:05 oltp_common.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1290 12 10 01:05 oltp_delete.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   2415 12 10 01:05 oltp_insert.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1265 12 10 01:05 oltp_point_select.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1649 12 10 01:05 oltp_read_only.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1824 12 10 01:05 oltp_read_write.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1118 12 10 01:05 oltp_update_index.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1127 12 10 01:05 oltp_update_non_index.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1440 12 10 01:05 oltp_write_only.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   1919 12 10 01:05 select_random_points.lua
-rwxr-xr-x  1 ShaoGaoJie  admin   2118 12 10 01:05 select_random_ranges.lua

```
### sysbench oltp测试 查看帮助
```
➜  mysqldata git:(master) ✗ sysbench --help
Usage:
  sysbench [options]... [testname] [command]

Commands implemented by most tests: prepare run cleanup help

General options:
  --threads=N                     number of threads to use [1]
  --events=N                      limit for total number of events [0]
  --time=N                        limit for total execution time in seconds [10]
  --forced-shutdown=STRING        number of seconds to wait after the --time limit before forcing shutdown, or 'off' to disable [off]
  --thread-stack-size=SIZE        size of stack per thread [64K]
  --rate=N                        average transactions rate. 0 for unlimited rate [0]
  --report-interval=N             periodically report intermediate statistics with a specified interval in seconds. 0 disables intermediate reports [0]
  --report-checkpoints=[LIST,...] dump full statistics and reset all counters at specified points in time. The argument is a list of comma-separated values representing the amount of time in seconds elapsed from start of test when report checkpoint(s) must be performed. Report checkpoints are off by default. []
  --debug[=on|off]                print more debugging info [off]
  --validate[=on|off]             perform validation checks where possible [off]
  --help[=on|off]                 print help and exit [off]
  --version[=on|off]              print version and exit [off]
  --config-file=FILENAME          File containing command line options
  --tx-rate=N                     deprecated alias for --rate [0]
  --max-requests=N                deprecated alias for --events [0]
  --max-time=N                    deprecated alias for --time [0]
  --num-threads=N                 deprecated alias for --threads [1]

Pseudo-Random Numbers Generator options:
  --rand-type=STRING random numbers distribution {uniform,gaussian,special,pareto} [special]
  --rand-spec-iter=N number of iterations used for numbers generation [12]
  --rand-spec-pct=N  percentage of values to be treated as 'special' (for special distribution) [1]
  --rand-spec-res=N  percentage of 'special' values to use (for special distribution) [75]
  --rand-seed=N      seed for random number generator. When 0, the current time is used as a RNG seed. [0]
  --rand-pareto-h=N  parameter h for pareto distribution [0.2]

Log options:
  --verbosity=N verbosity level {5 - debug, 0 - only critical messages} [3]

  --percentile=N       percentile to calculate in latency statistics (1-100). Use the special value of 0 to disable percentile calculations [95]
  --histogram[=on|off] print latency histogram in report [off]

General database options:

  --db-driver=STRING  specifies database driver to use ('help' to get list of available drivers)
  --db-ps-mode=STRING prepared statements usage mode {auto, disable} [auto]
  --db-debug[=on|off] print database-specific debug information [off]


Compiled-in database drivers:
  mysql - MySQL driver
++++++++++++++++++++lotp mysql 连接的相关参数++++++++++++++++++++++++++++++++++++
mysql options:
  --mysql-host=[LIST,...]          MySQL server host [localhost]
  --mysql-port=[LIST,...]          MySQL server port [3306]
  --mysql-socket=[LIST,...]        MySQL socket
  --mysql-user=STRING              MySQL user [sbtest]
  --mysql-password=STRING          MySQL password []
  --mysql-db=STRING                MySQL database name [sbtest]
  --mysql-ssl[=on|off]             use SSL connections, if available in the client library [off]
  --mysql-ssl-cipher=STRING        use specific cipher for SSL connections []
  --mysql-compression[=on|off]     use compression, if available in the client library [off]
  --mysql-debug[=on|off]           trace all client library calls [off]
  --mysql-ignore-errors=[LIST,...] list of errors to ignore, or "all" [1213,1020,1205]
  --mysql-dry-run[=on|off]         Dry run, pretend that all MySQL client API calls are successful without executing them [off]
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Compiled-in tests:
  fileio - File I/O test
  cpu - CPU performance test
  memory - Memory functions speed test
  threads - Threads subsystem performance test
  mutex - Mutex performance test

See 'sysbench <testname> help' for a list of options for each test.

➜  mysqldata git:(master) ✗

根据不同的测试脚本调用不同的测试参数
➜  mysqldata git:(master) ✗ sysbench /usr/local/Cellar/sysbench/1.0.11_1/share/sysbench/oltp_common.lua  help
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

oltp_common.lua options:
  --distinct_ranges=N           Number of SELECT DISTINCT queries per transaction [1]
  --sum_ranges=N                Number of SELECT SUM() queries per transaction [1]
  --skip_trx[=on|off]           Don't start explicit transactions and execute all queries in the AUTOCOMMIT mode [off]
  --secondary[=on|off]          Use a secondary index in place of the PRIMARY KEY [off]
  --create_secondary[=on|off]   Create a secondary index in addition to the PRIMARY KEY [on]
  --index_updates=N             Number of UPDATE index queries per transaction [1]
  --range_size=N                Range size for range SELECT queries [100]
  --auto_inc[=on|off]           Use AUTO_INCREMENT column as Primary Key (for MySQL), or its alternatives in other DBMS. When disabled, use client-generated IDs [on]
  --delete_inserts=N            Number of DELETE/INSERT combination per transaction [1]
  --tables=N                    Number of tables [1]
  --mysql_storage_engine=STRING Storage engine, if MySQL is used [innodb]
  --non_index_updates=N         Number of UPDATE non-index queries per transaction [1]
  --table_size=N                Number of rows per table [10000]
  --pgsql_variant=STRING        Use this PostgreSQL variant when running with the PostgreSQL driver. The only currently supported variant is 'redshift'. When enabled, create_secondary is automatically disabled, and delete_inserts is set to 0
  --simple_ranges=N             Number of simple range SELECT queries per transaction [1]
  --order_ranges=N              Number of SELECT ORDER BY queries per transaction [1]
  --range_selects[=on|off]      Enable/disable all range SELECT queries [on]
  --point_selects=N             Number of point SELECT queries per transaction [10]
```
#### 测试案例
```
1. prepare
 sysbench /usr/local/Cellar/sysbench/1.0.11_1/share/sysbench/oltp_common.lua --tables=4 --table-size=100000  --mysql-host=127.0.0.1 --mysql-user=root --mysql-password='' --threads=16 --max-requests=0 --time=3000 --report-interval=3  --mysql-port=3307 --mysql-db=test prepare
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

Initializing worker threads...

Creating table 'sbtest2'...
Inserting 100000 records into 'sbtest2'
Creating table 'sbtest4'...
Creating table 'sbtest3'...
Inserting 100000 records into 'sbtest4'
Creating table 'sbtest1'...
Inserting 100000 records into 'sbtest3'
Inserting 100000 records into 'sbtest1'
Creating a secondary index on 'sbtest2'...
Creating a secondary index on 'sbtest1'...
Creating a secondary index on 'sbtest3'...
Creating a secondary index on 'sbtest4'...


(root@localhost)[test]> show create table sbtest1;
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table                                                                                                                                                                                                                                                                       |
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| sbtest1 | CREATE TABLE `sbtest1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `k` int(11) NOT NULL DEFAULT '0',
  `c` char(120) NOT NULL DEFAULT '',
  `pad` char(60) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  KEY `k_1` (`k`)
) ENGINE=InnoDB AUTO_INCREMENT=100001 DEFAULT CHARSET=utf8 |
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)


2. run
➜  mysqldata git:(master) ✗ sysbench /usr/local/Cellar/sysbench/1.0.11_1/share/sysbench/oltp_read_only.lua --tables=4 --table-size=100000  --mysql-host=127.0.0.1 --mysql-user=root --mysql-password='' --threads=16 --max-requests=0 --time=30 --report-interval=3  --mysql-port=3307 --mysql-db=test run
sysbench 1.0.11 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 16
Report intermediate results every 3 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

[ 3s ] thds: 16 tps: 423.43 qps: 6818.76 (r/w/o: 5966.58/0.00/852.18) lat (ms,95%): 47.47 err/s: 0.00 reconn/s: 0.00
[ 6s ] thds: 16 tps: 427.27 qps: 6835.27 (r/w/o: 5981.41/0.00/853.87) lat (ms,95%): 49.21 err/s: 0.00 reconn/s: 0.00
[ 9s ] thds: 16 tps: 439.10 qps: 7035.53 (r/w/o: 6157.00/0.00/878.52) lat (ms,95%): 42.61 err/s: 0.00 reconn/s: 0.00
[ 12s ] thds: 16 tps: 378.86 qps: 6050.47 (r/w/o: 5292.75/0.00/757.72) lat (ms,95%): 66.84 err/s: 0.00 reconn/s: 0.00
[ 15s ] thds: 16 tps: 368.69 qps: 5892.29 (r/w/o: 5154.92/0.00/737.37) lat (ms,95%): 69.29 err/s: 0.00 reconn/s: 0.00
[ 18s ] thds: 16 tps: 413.34 qps: 6625.37 (r/w/o: 5799.36/0.00/826.00) lat (ms,95%): 49.21 err/s: 0.00 reconn/s: 0.00
[ 21s ] thds: 16 tps: 403.30 qps: 6457.84 (r/w/o: 5650.23/0.00/807.60) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00
[ 24s ] thds: 16 tps: 414.32 qps: 6616.76 (r/w/o: 5788.46/0.00/828.30) lat (ms,95%): 50.11 err/s: 0.00 reconn/s: 0.00
[ 27s ] thds: 16 tps: 411.07 qps: 6577.39 (r/w/o: 5756.26/0.00/821.13) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00
[ 30s ] thds: 16 tps: 407.11 qps: 6519.38 (r/w/o: 5703.83/0.00/815.55) lat (ms,95%): 53.85 err/s: 0.00 reconn/s: 0.00
SQL statistics:
    queries performed:
        read:                            171878
        write:                           0
        other:                           24554
        total:                           196432
    transactions:                        12277  (407.35 per sec.)
    queries:                             196432 (6517.63 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          30.1366s
    total number of events:              12277

Latency (ms):
         min:                                 19.24
         avg:                                 39.15
         max:                                123.48
         95th percentile:                     54.83
         sum:                             480701.04

Threads fairness:
    events (avg/stddev):           767.3125/4.19
    execution time (avg/stddev):   30.0438/0.03
```

### Threads\_running Threads_connected 参数设置

```
(root@localhost)[test]> show global status like 'thread%';
+-------------------+-------+
| Variable_name     | Value |
+-------------------+-------+
| Threads_cached    | 9     |
| Threads_connected | 3     |--------- 当前有多少个线程连着
| Threads_created   | 506   |
| Threads_running   | 1     |--------- 当前有多少个线程运行
+-------------------+-------+
4 rows in set (0.06 sec)

正常情况下，Threads_running < Threads_connected .

那么 什么情况下Threads_running 会接近Threads_connected呢？ 一般情况下，慢查询会导致这种情况发生。too many connections。不是增大 max connections 而是要优化慢查询语句。


(root@localhost)[test]> show variables like 'max_connections%';
+-----------------+-------+
| Variable_name   | Value |
+-----------------+-------+
| max_connections | 151   |
+-----------------+-------+
1 row in set (0.01 sec)


```


## tpcc
### 安装 https://github.com/Percona-Lab/tpcc-mysql
```
[root@10.70.1.232 home]#mkdir git
[root@10.70.1.232 home]#cd git/
[root@10.70.1.232 git]#ll
total 0

## git clone 源文件
[root@10.70.1.232 git]#git clone https://github.com/Percona-Lab/tpcc-mysql.git
Cloning into 'tpcc-mysql'...
remote: Counting objects: 392, done.
remote: Total 392 (delta 0), reused 0 (delta 0), pack-reused 392
Receiving objects: 100% (392/392), 202.87 KiB | 107.00 KiB/s, done.
Resolving deltas: 100% (216/216), done.
[root@10.70.1.232 git]#ll
total 4
drwxr-xr-x 6 root root 4096 Jan 17 01:19 tpcc-mysql
[root@10.70.1.232 git]#cd tpcc-mysql/src/
[root@10.70.1.232 src]#ll
total 192
-rw-r--r-- 1 root root  7875 Jan 17 01:19 delivery.c
-rw-r--r-- 1 root root 10163 Jan 17 01:19 driver.c
-rw-r--r-- 1 root root 36435 Jan 17 01:19 load.c
-rw-r--r-- 1 root root 25966 Jan 17 01:19 main.c
-rw-r--r-- 1 root root   594 Jan 17 01:19 Makefile
-rw-r--r-- 1 root root 16241 Jan 17 01:19 neword.c
-rw-r--r-- 1 root root 10607 Jan 17 01:19 ordstat.c
-rw-r--r-- 1 root root   617 Jan 17 01:19 parse_port.h
-rw-r--r-- 1 root root 17302 Jan 17 01:19 payment.c
-rw-r--r-- 1 root root  2990 Jan 17 01:19 rthist.c
-rw-r--r-- 1 root root   142 Jan 17 01:19 rthist.h
-rw-r--r-- 1 root root  3372 Jan 17 01:19 sb_percentile.c
-rw-r--r-- 1 root root  1570 Jan 17 01:19 sb_percentile.h
-rw-r--r-- 1 root root  1200 Jan 17 01:19 sequence.c
-rw-r--r-- 1 root root    89 Jan 17 01:19 sequence.h
-rw-r--r-- 1 root root  5291 Jan 17 01:19 slev.c
-rw-r--r-- 1 root root   497 Jan 17 01:19 spt_proc.c
-rw-r--r-- 1 root root   123 Jan 17 01:19 spt_proc.h
-rw-r--r-- 1 root root  3656 Jan 17 01:19 support.c
-rw-r--r-- 1 root root  2261 Jan 17 01:19 tpc.h
-rw-r--r-- 1 root root   688 Jan 17 01:19 trans_if.h

## 编译
[root@10.70.1.232 src]#make
cc -w -O3 -g -I. `mysql_config --include`  -c load.c
cc -w -O3 -g -I. `mysql_config --include`  -c support.c
cc load.o support.o `mysql_config --libs_r` -lrt -o ../tpcc_load
cc -w -O3 -g -I. `mysql_config --include`  -c main.c
cc -w -O3 -g -I. `mysql_config --include`  -c spt_proc.c
cc -w -O3 -g -I. `mysql_config --include`  -c driver.c
cc -w -O3 -g -I. `mysql_config --include`  -c sequence.c
cc -w -O3 -g -I. `mysql_config --include`  -c rthist.c
cc -w -O3 -g -I. `mysql_config --include`  -c sb_percentile.c
cc -w -O3 -g -I. `mysql_config --include`  -c neword.c
cc -w -O3 -g -I. `mysql_config --include`  -c payment.c
cc -w -O3 -g -I. `mysql_config --include`  -c ordstat.c
cc -w -O3 -g -I. `mysql_config --include`  -c delivery.c
cc -w -O3 -g -I. `mysql_config --include`  -c slev.c
cc main.o spt_proc.o driver.o support.o sequence.o rthist.o sb_percentile.o neword.o payment.o ordstat.o delivery.o slev.o `mysql_config --libs_r` -lrt -o ../tpcc_start
[root@10.70.1.232 src]#

```


## mysqlslap
```
➜  mysql_learning git:(master) ✗ mysqlslap --help
mysqlslap  Ver 1.0 Distrib 5.7.20, for osx10.13 (x86_64)
Copyright (c) 2005, 2017, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Run a query multiple times against the server.

Usage: mysqlslap [OPTIONS]

Default options are read from the following files in the given order:
/etc/my.cnf /etc/mysql/my.cnf /usr/local/etc/my.cnf ~/.my.cnf
The following groups are read: mysqlslap client
The following options may be given as the first argument:
--print-defaults        Print the program argument list and exit.
--no-defaults           Don't read default options from any option file,
                        except for login file.
--defaults-file=#       Only read default options from the given file #.
--defaults-extra-file=# Read this file after the global files are read.
--defaults-group-suffix=#
                        Also read groups with concat(group, suffix)
--login-path=#          Read this path from the login file.
  -?, --help          Display this help and exit.
  -a, --auto-generate-sql
                      Generate SQL where not supplied by file or command line.
  --auto-generate-sql-add-autoincrement
                      Add an AUTO_INCREMENT column to auto-generated tables.
  --auto-generate-sql-execute-number=#
                      Set this number to generate a set number of queries to
                      run.
  --auto-generate-sql-guid-primary
                      Add GUID based primary keys to auto-generated tables.
  --auto-generate-sql-load-type=name
                      Specify test load type: mixed, update, write, key, or
                      read; default is mixed.
  --auto-generate-sql-secondary-indexes=#
                      Number of secondary indexes to add to auto-generated
                      tables.
  --auto-generate-sql-unique-query-number=#
                      Number of unique queries to generate for automatic tests.
  --auto-generate-sql-unique-write-number=#
                      Number of unique queries to generate for
                      auto-generate-sql-write-number.
  --auto-generate-sql-write-number=#
                      Number of row inserts to perform for each thread (default
                      is 100).
  --commit=#          Commit records every X number of statements.
  -C, --compress      Use compression in server/client protocol.
  -c, --concurrency=name
                      Number of clients to simulate for query to run.
  --create=name       File or string to use create tables.
  --create-schema=name
                      Schema to run tests in.
  --csv[=name]        Generate CSV output to named file or to stdout if no file
                      is named.
  -#, --debug[=#]     This is a non-debug version. Catch this and exit.
  --debug-check       This is a non-debug version. Catch this and exit.
  -T, --debug-info    This is a non-debug version. Catch this and exit.
  --default-auth=name Default authentication client-side plugin to use.
  -F, --delimiter=name
                      Delimiter to use in SQL statements supplied in file or
                      command line.
  --detach=#          Detach (close and reopen) connections after X number of
                      requests.
  --enable-cleartext-plugin
                      Enable/disable the clear text authentication plugin.
  -e, --engine=name   Storage engine to use for creating the table.
  -h, --host=name     Connect to host.
  -i, --iterations=#  Number of times to run the tests.
  --no-drop           Do not drop the schema after the test.
  -x, --number-char-cols=name
                      Number of VARCHAR columns to create in table if
                      specifying --auto-generate-sql.
  -y, --number-int-cols=name
                      Number of INT columns to create in table if specifying
                      --auto-generate-sql.
  --number-of-queries=#
                      Limit each client to this number of queries (this is not
                      exact).
  --only-print        Do not connect to the databases, but instead print out
                      what would have been done.
  -p, --password[=name]
                      Password to use when connecting to server. If password is
                      not given it's asked from the tty.
  --plugin-dir=name   Directory for client-side plugins.
  -P, --port=#        Port number to use for connection.
  --post-query=name   Query to run or file containing query to execute after
                      tests have completed.
  --post-system=name  system() string to execute after tests have completed.
  --pre-query=name    Query to run or file containing query to execute before
                      running tests.
  --pre-system=name   system() string to execute before running tests.
  --protocol=name     The protocol to use for connection (tcp, socket, pipe,
                      memory).
  -q, --query=name    Query to run or file containing query to run.
  --secure-auth       Refuse client connecting to server if it uses old
                      (pre-4.1.1) protocol. Deprecated. Always TRUE
  -s, --silent        Run program in silent mode - no output.
  -S, --socket=name   The socket file to use for connection.
  --sql-mode=name     Specify sql-mode to run mysqlslap tool.
  --ssl-mode=name     SSL connection mode.
  --ssl               Deprecated. Use --ssl-mode instead.
                      (Defaults to on; use --skip-ssl to disable.)
  --ssl-verify-server-cert
                      Deprecated. Use --ssl-mode=VERIFY_IDENTITY instead.
  --ssl-ca=name       CA file in PEM format.
  --ssl-capath=name   CA directory.
  --ssl-cert=name     X509 cert in PEM format.
  --ssl-cipher=name   SSL cipher to use.
  --ssl-key=name      X509 key in PEM format.
  --ssl-crl=name      Certificate revocation list.
  --ssl-crlpath=name  Certificate revocation list path.
  --tls-version=name  TLS version to use, permitted values are: TLSv1, TLSv1.1,
                      TLSv1.2
  -u, --user=name     User for login if not current user.
  -v, --verbose       More verbose output; you can use this multiple times to
                      get even more verbose output.
  -V, --version       Output version information and exit.
➜  mysql_learning git:(master) ✗

```

### 案例分析
```
➜  mysql_learning git:(master) ✗ mysqlslap --query=mysqlslap_select.sql -c 4 --number-of-queries=100000 --host=127.0.0.1 --user=root --create-schema=dbt3
Benchmark
	Average number of seconds to run all queries: 8.026 seconds
	Minimum number of seconds to run all queries: 8.026 seconds
	Maximum number of seconds to run all queries: 8.026 seconds
	Number of clients running queries: 4
	Average number of queries per client: 25000
```



